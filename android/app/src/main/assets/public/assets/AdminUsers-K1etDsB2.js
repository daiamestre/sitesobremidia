import{c as k,r as l,j as e,p as d,u as W,e as Y,d as Z,s as g,g as f,B as q,X as ee}from"./index-D7tYTXxn.js";import{C as m,a as x,b as u,d as h,c as se}from"./card-5zark0gk.js";import{B as N}from"./badge-gbZeG4Gf.js";import{T as ae,a as re,b as v,c as te}from"./tabs-C0bnNcOd.js";import{A as ne,a as le,b as ie,c as de,d as oe,e as ce,f as me,g as xe}from"./alert-dialog-7xNNm5oB.js";import{C as S}from"./clock-n69t5Sco.js";import{C as ue}from"./check-D51vMB7M.js";import"./index-DTJUssfv.js";import"./index-sMVqN4fH.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=k("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=k("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=k("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),L=l.forwardRef(({className:r,...t},n)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:n,className:d("w-full caption-bottom text-sm",r),...t})}));L.displayName="Table";const M=l.forwardRef(({className:r,...t},n)=>e.jsx("thead",{ref:n,className:d("[&_tr]:border-b",r),...t}));M.displayName="TableHeader";const I=l.forwardRef(({className:r,...t},n)=>e.jsx("tbody",{ref:n,className:d("[&_tr:last-child]:border-0",r),...t}));I.displayName="TableBody";const je=l.forwardRef(({className:r,...t},n)=>e.jsx("tfoot",{ref:n,className:d("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...t}));je.displayName="TableFooter";const T=l.forwardRef(({className:r,...t},n)=>e.jsx("tr",{ref:n,className:d("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",r),...t}));T.displayName="TableRow";const o=l.forwardRef(({className:r,...t},n)=>e.jsx("th",{ref:n,className:d("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...t}));o.displayName="TableHead";const c=l.forwardRef(({className:r,...t},n)=>e.jsx("td",{ref:n,className:d("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...t}));c.displayName="TableCell";const pe=l.forwardRef(({className:r,...t},n)=>e.jsx("caption",{ref:n,className:d("mt-4 text-sm text-muted-foreground",r),...t}));pe.displayName="TableCaption";function ke(){var B,E;const[r,t]=l.useState([]),[n,A]=l.useState(!0),[j,b]=l.useState(null),[P,$]=l.useState(!1),[i,y]=l.useState({open:!1,user:null,action:null}),{user:w}=W(),{toast:p}=Y(),D=Z();l.useEffect(()=>{O()},[w]);const O=async()=>{if(!w){D("/auth");return}const{data:s}=await g.from("user_roles").select("role").eq("user_id",w.id).eq("role","admin").single();if(!s){p({title:"Acesso negado",description:"Você não tem permissão para acessar esta página.",variant:"destructive"}),D("/dashboard");return}$(!0),R()},R=async()=>{A(!0);const{data:s,error:a}=await g.from("profiles").select("*").order("created_at",{ascending:!1});a?(console.error("Error fetching users:",a),p({title:"Erro ao carregar usuários",description:a.message,variant:"destructive"})):t(s||[]),A(!1)},X=async(s,a)=>{b(s.id);const{error:H}=await g.from("profiles").update({status:a}).eq("id",s.id);if(H){p({title:"Erro ao atualizar status",description:H.message,variant:"destructive"}),b(null);return}try{await g.functions.invoke("send-status-notification",{body:{full_name:s.full_name,email:s.email,status:a,company_name:s.company_name}}),console.log("Status notification email sent")}catch(Q){console.error("Failed to send notification email:",Q)}p({title:a==="approved"?"Usuário aprovado!":"Usuário rejeitado",description:`${s.full_name} foi ${a==="approved"?"aprovado":"rejeitado"} com sucesso.`}),b(null),y({open:!1,user:null,action:null}),R()},_=(s,a)=>{y({open:!0,user:s,action:a})},V=s=>{switch(s){case"pending":return e.jsxs(N,{variant:"outline",className:"bg-yellow-500/10 text-yellow-500 border-yellow-500/30",children:[e.jsx(S,{className:"h-3 w-3 mr-1"})," Pendente"]});case"approved":return e.jsxs(N,{variant:"outline",className:"bg-green-500/10 text-green-500 border-green-500/30",children:[e.jsx(z,{className:"h-3 w-3 mr-1"})," Aprovado"]});case"rejected":return e.jsxs(N,{variant:"outline",className:"bg-red-500/10 text-red-500 border-red-500/30",children:[e.jsx(F,{className:"h-3 w-3 mr-1"})," Rejeitado"]});default:return null}},G=s=>new Date(s).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),U=s=>s==="all"?r:r.filter(a=>a.status===s);if(!P)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(f,{className:"h-8 w-8 animate-spin text-primary"})});const C=r.filter(s=>s.status==="pending").length,J=r.filter(s=>s.status==="approved").length,K=r.filter(s=>s.status==="rejected").length;return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold",children:"Gerenciar Usuários"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Aprove ou rejeite solicitações de acesso"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(m,{className:"glass",children:[e.jsx(x,{className:"pb-2",children:e.jsx(u,{className:"text-sm font-medium text-muted-foreground",children:"Total"})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-2xl font-bold",children:r.length})]})})]}),e.jsxs(m,{className:"glass",children:[e.jsx(x,{className:"pb-2",children:e.jsx(u,{className:"text-sm font-medium text-muted-foreground",children:"Pendentes"})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{className:"text-2xl font-bold",children:C})]})})]}),e.jsxs(m,{className:"glass",children:[e.jsx(x,{className:"pb-2",children:e.jsx(u,{className:"text-sm font-medium text-muted-foreground",children:"Aprovados"})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-2xl font-bold",children:J})]})})]}),e.jsxs(m,{className:"glass",children:[e.jsx(x,{className:"pb-2",children:e.jsx(u,{className:"text-sm font-medium text-muted-foreground",children:"Rejeitados"})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{className:"text-2xl font-bold",children:K})]})})]})]}),e.jsxs(m,{className:"glass",children:[e.jsxs(x,{children:[e.jsx(u,{children:"Usuários"}),e.jsx(se,{children:"Lista de todos os usuários cadastrados no sistema"})]}),e.jsx(h,{children:e.jsxs(ae,{defaultValue:"pending",children:[e.jsxs(re,{className:"mb-4",children:[e.jsxs(v,{value:"pending",className:"gap-2",children:["Pendentes ",C>0&&e.jsx(N,{variant:"secondary",className:"ml-1",children:C})]}),e.jsx(v,{value:"approved",children:"Aprovados"}),e.jsx(v,{value:"rejected",children:"Rejeitados"}),e.jsx(v,{value:"all",children:"Todos"})]}),["pending","approved","rejected","all"].map(s=>e.jsx(te,{value:s,children:n?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(f,{className:"h-8 w-8 animate-spin text-primary"})}):U(s).length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Nenhum usuário encontrado"}):e.jsx("div",{className:"rounded-md border border-border/50",children:e.jsxs(L,{children:[e.jsx(M,{children:e.jsxs(T,{children:[e.jsx(o,{children:"Nome"}),e.jsx(o,{children:"E-mail"}),e.jsx(o,{children:"Empresa"}),e.jsx(o,{children:"Data de Cadastro"}),e.jsx(o,{children:"Status"}),e.jsx(o,{className:"text-right",children:"Ações"})]})}),e.jsx(I,{children:U(s).map(a=>e.jsxs(T,{children:[e.jsx(c,{className:"font-medium",children:a.full_name}),e.jsx(c,{children:a.email}),e.jsx(c,{children:a.company_name}),e.jsx(c,{children:G(a.created_at)}),e.jsx(c,{children:V(a.status)}),e.jsx(c,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[a.status!=="approved"&&e.jsx(q,{size:"sm",variant:"outline",className:"border-green-500/30 text-green-500 hover:bg-green-500/10",onClick:()=>_(a,"approved"),disabled:j===a.id,children:j===a.id?e.jsx(f,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4 mr-1"})," Aprovar"]})}),a.status!=="rejected"&&e.jsx(q,{size:"sm",variant:"outline",className:"border-red-500/30 text-red-500 hover:bg-red-500/10",onClick:()=>_(a,"rejected"),disabled:j===a.id,children:j===a.id?e.jsx(f,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 mr-1"})," Rejeitar"]})})]})})]},a.id))})]})})},s))]})})]}),e.jsx(ne,{open:i.open,onOpenChange:s=>y({...i,open:s}),children:e.jsxs(le,{className:"glass",children:[e.jsxs(ie,{children:[e.jsx(de,{children:i.action==="approved"?"Aprovar usuário?":"Rejeitar usuário?"}),e.jsx(oe,{children:i.action==="approved"?`Tem certeza que deseja aprovar ${(B=i.user)==null?void 0:B.full_name}? O usuário receberá um e-mail de confirmação.`:`Tem certeza que deseja rejeitar ${(E=i.user)==null?void 0:E.full_name}? O usuário será notificado por e-mail.`})]}),e.jsxs(ce,{children:[e.jsx(me,{children:"Cancelar"}),e.jsx(xe,{className:i.action==="approved"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700",onClick:()=>i.user&&i.action&&X(i.user,i.action),children:i.action==="approved"?"Aprovar":"Rejeitar"})]})]})})]})}export{ke as default};
