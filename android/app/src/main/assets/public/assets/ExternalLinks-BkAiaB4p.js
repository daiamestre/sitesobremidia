import{c as ne,u as xe,r as o,j as e,B as d,a2 as Ee,g as se,I as oe,s as y,x as l,y as $e,P as ce,a1 as Ae,O as Le,X as de}from"./index-BIw4YUGd.js";import{C as te,d as ie}from"./card-CV21M-nN.js";import{I as H}from"./input-ClxgF6ef.js";import{u as _e}from"./useQuery-BY5vm64i.js";import{u as me}from"./index-LZhMg3qy.js";import{S as ze,E as Fe,T as pe,D as he,a as ge,b as qe,c as Te,d as Ue}from"./skeleton-CNJ59E-z.js";import{L as F}from"./label-CZ2eJaUL.js";import{S as je,a as ve,b as be,c as Ne,d as we}from"./select-CTxMGri8.js";import{T as ye,a as Se,b as ae,c as ue}from"./tabs-BLxlA1-_.js";import{B as De}from"./badge-txkClHpg.js";import{U as Ie}from"./upload-B64iRs8f.js";import{V as Oe}from"./video-CEtQmOzZ.js";import{C as Ve}from"./circle-check-HRS7WsjU.js";import{P as Ge}from"./play-CmbCMDDK.js";import{A as Be,a as Qe,b as We,c as Je,d as He,e as Me,f as Re,g as Ke}from"./alert-dialog-fpOX6zNm.js";import{S as Xe}from"./search-Dx2gYc4E.js";import"./index-Db6mGbV6.js";import"./index-DHwCTHmR.js";import"./index-e1UCY7pb.js";import"./check-D1yzJIhg.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=ne("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=ne("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=ne("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);function fe({onSelect:k,onApplyToInstagram:$,isApplying:A,availableLinks:re=[],selectionMode:f=!1,onSelectionConfirm:C}){const{user:v}=xe(),[q,T]=o.useState([]),[U,P]=o.useState(!1),[L,D]=o.useState(!1),[i,M]=o.useState("posts"),[b,R]=o.useState(""),[c,S]=o.useState([]),[N,_]=o.useState(null),w=re.filter(r=>r.platform==="instagram");o.useEffect(()=>{!f&&w.length===1&&!b&&R(w[0].id)},[w,b,f]);const I=async()=>{if(v)try{P(!0);const r=`${v.id}/social/${i}`,{data:t,error:n}=await y.storage.from("media").list(r,{limit:100,offset:0,sortBy:{column:"created_at",order:"desc"}});if(n)throw n;const x=(t||[]).filter(p=>p.name!==".emptyFolderPlaceholder").map(p=>{var z,W;const{data:{publicUrl:X}}=y.storage.from("media").getPublicUrl(`${r}/${p.name}`);return{name:p.name,id:p.id||p.name,created_at:p.created_at,size:((z=p.metadata)==null?void 0:z.size)||0,type:((W=p.metadata)==null?void 0:W.mimetype)||"unknown",url:X}});T(x)}catch(r){console.error("Error fetching assets:",r),r.message!=="The resource was not found"&&l.error("Erro ao listar arquivos")}finally{P(!1)}};o.useEffect(()=>{I(),S([])},[v,i]);const O=async r=>{var m;const t=r.target.files;if(!t||t.length===0||!v)return;D(!0);let n=0;try{for(let E=0;E<t.length;E++){const x=t[E];if(!x.type.startsWith("image/")&&!x.type.startsWith("video/")){l.error(`Arquivo ignorado (tipo inválido): ${x.name}`);continue}const p=(m=x.name.split(".").pop())==null?void 0:m.toLowerCase(),X=x.name.replace(/[^a-zA-Z0-9]/g,"_"),z=`manual_${Date.now()}_${X}.${p}`,W=`${v.id}/social/${i}/${z}`,{error:J}=await y.storage.from("media").upload(W,x,{upsert:!0});J?(console.error(`Error uploading ${x.name}:`,J),l.error(`Erro ao enviar ${x.name}`)):n++}n>0&&(l.success(`${n} arquivo(s) enviado(s)!`),I())}catch(E){console.error("Upload error:",E),l.error("Erro crítico no upload")}finally{D(!1),r.target.value=""}},le=async r=>{if(!(!v||!confirm("Excluir este arquivo permanentemente?")))try{const{error:t}=await y.storage.from("media").remove([`${v.id}/social/${i}/${r}`]);if(t)throw t;l.success("Arquivo excluído"),T(n=>n.filter(m=>m.name!==r)),S(n=>n.filter(m=>m.name!==r))}catch(t){console.error("Delete error:",t),l.error("Erro ao excluir arquivo")}},V=r=>{if(i==="perfil"){if(r.name.match(/\.(mp4|webm|mov)$/i)){l.warning("A foto de perfil deve ser uma imagem, não um vídeo.");return}S([r]);return}if(c.find(t=>t.id===r.id))S(t=>t.filter(n=>n.id!==r.id));else{if(c.length>=3){l.warning("Você só pode selecionar até 3 posts para o card.");return}S(t=>[...t,r])}},G=()=>{if(C){if(i==="perfil"&&c.length!==1){l.error("Selecione exatamente 1 foto para o perfil.");return}if(i==="posts"&&c.length===0){l.error("Selecione pelo menos 1 item.");return}C(c,i)}},B=()=>{if(f){G();return}if($){if(!b){l.error("Selecione um Card/Link de destino na lista acima.");return}if(i==="perfil"){if(c.length!==1){l.error("Selecione exatamente 1 foto para o perfil.");return}$("profile",c[0].url,b)}else{if(c.length===0){l.error("Selecione pelo menos 1 vídeo/post.");return}const r=c.map(t=>({src:t.url,type:t.name.match(/\.(mp4|webm|mov)$/i)?"video":"image"}));$("posts",r,b)}}},K=()=>i==="perfil"?"Selecione a Foto de Perfil (Obrigatório)":"Selecione os Posts para serem Visualizados no seu Perfil",Q=()=>A||!f&&!b?!0:i==="perfil"?c.length!==1:c.length===0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:`p-4 rounded-xl border space-y-4 ${f?"bg-zinc-800 border-zinc-700":"bg-muted/30"}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[f?"Galeria":"Galeria Social",c.length>0&&e.jsxs(De,{variant:"secondary",className:"ml-2",children:[c.length," ",i==="perfil"?"selecionada":"selecionados"]})]}),e.jsxs("p",{className:"text-sm font-medium text-blue-500 flex items-center gap-1.5 mt-1 bg-blue-500/10 px-3 py-1 rounded-full w-fit",children:[e.jsx(Ye,{className:"w-4 h-4"}),K()]})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(d,{variant:"outline",size:"icon",onClick:I,title:"Atualizar",children:e.jsx(Ee,{className:`h-4 w-4 ${U?"animate-spin":""}`})}),e.jsxs("div",{className:"relative flex-1 sm:flex-initial",children:[e.jsx("input",{type:"file",accept:i==="perfil"?"image/*":"image/*,video/*",multiple:i==="posts",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",onChange:O,disabled:L}),e.jsxs(d,{disabled:L,className:"w-full",variant:"secondary",children:[L?e.jsx(se,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Upload"]})]})]})]}),c.length>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4 bg-zinc-900/50 p-4 rounded-xl border border-zinc-800 animate-in fade-in slide-in-from-top-2",children:[!f&&e.jsxs("div",{className:"flex-1 w-full flex items-center gap-3",children:[e.jsx("div",{className:"shrink-0 bg-blue-500/10 p-2 rounded-full",children:e.jsx(Ze,{className:"w-4 h-4 text-blue-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-xs text-zinc-400 font-bold uppercase tracking-wider mb-1.5",children:["Destino do ",i==="perfil"?"Perfil":"Post"]}),e.jsxs(je,{value:b,onValueChange:R,disabled:w.length===0,children:[e.jsx(ve,{className:"w-full bg-black/20 border-zinc-700 text-zinc-100",children:e.jsx(be,{placeholder:w.length===0?"Nenhum card do Instagram criado":"Selecione o Card para vincular..."})}),e.jsx(Ne,{children:w.map(r=>e.jsxs(we,{value:r.id,children:[r.title," (",r.platform,")"]},r.id))})]})]})]}),($||f)&&e.jsx("div",{className:`w-full ${f?"flex justify-end":"sm:w-auto mt-auto sm:self-end"}`,children:e.jsxs(d,{type:f?"button":"submit",onClick:r=>{f?(r.preventDefault(),G()):B()},disabled:Q(),className:`w-full sm:w-auto h-10 px-6 ${i==="perfil"?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gradient-to-r from-purple-600 to-orange-500 hover:opacity-90 text-white border-0"}`,children:[A&&e.jsx(se,{className:"w-4 h-4 mr-2 animate-spin"}),f?i==="perfil"?"Confirmar Foto de Perfil":"Confirmar Posts":i==="perfil"?"Definir Foto":"Usar Posts"]})})]})]}),e.jsxs(ye,{value:i,onValueChange:M,className:"w-full",children:[e.jsxs(Se,{className:"grid w-full grid-cols-2 max-w-[400px]",children:[e.jsx(ae,{value:"posts",children:"Meus Posts"}),e.jsx(ae,{value:"perfil",children:"Fotos de Perfil"})]}),e.jsx("div",{className:"mt-6 min-h-[300px]",children:U&&q.length===0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[...Array(6)].map((r,t)=>e.jsx(ze,{className:"aspect-square rounded-xl"},t))}):q.length===0?e.jsx(Fe,{icon:oe,title:`Nenhum arquivo em ${i}`,description:"Envie imagens ou vídeos para esta pasta."}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 animate-fade-in",children:q.map(r=>{const t=c.some(m=>m.id===r.id),n=r.name.match(/\.(mp4|webm|mov)$/i);return e.jsxs("div",{className:`group relative aspect-square rounded-xl overflow-hidden border transition-all duration-300 ${t?"ring-4 ring-purple-500 ring-offset-2":"hover:border-purple-300"}`,onClick:()=>V(r),children:[n?e.jsxs("div",{className:"w-full h-full flex items-center justify-center bg-black",children:[e.jsx("video",{src:r.url,className:"w-full h-full object-cover opacity-80",muted:!0}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(Oe,{className:"w-8 h-8 text-white/70"})})]}):e.jsx("img",{src:r.url,alt:r.name,className:"w-full h-full object-cover transition-transform group-hover:scale-105"}),t&&e.jsx("div",{className:"absolute top-2 right-2 bg-purple-600 text-white rounded-full p-1 shadow-lg z-20",children:e.jsx(Ve,{className:"w-4 h-4"})}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center gap-2 z-10",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{variant:"secondary",size:"sm",className:"h-8 w-8 rounded-full",onClick:m=>{m.stopPropagation(),_(r)},title:"Pré-visualizar",children:e.jsx(Ge,{className:"h-4 w-4 ml-0.5"})}),e.jsx(d,{variant:"destructive",size:"sm",className:"h-8 w-8 rounded-full",onClick:m=>{m.stopPropagation(),le(r.name)},title:"Excluir",children:e.jsx(pe,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-[10px] text-white/80 px-2 truncate max-w-full text-center mt-2",children:t?"Selecionado":"Clique para selecionar"})]})]},r.id)})})})]}),e.jsx(he,{open:!!N,onOpenChange:()=>_(null),children:e.jsx(ge,{className:"max-w-3xl bg-black border-white/10 p-1 rounded-2xl overflow-hidden text-white w-full aspect-video flex items-center justify-center",children:N&&(N.name.match(/\.(mp4|webm|mov)$/i)?e.jsx("video",{src:N.url,className:"w-full h-full max-h-[80vh] object-contain",controls:!0,autoPlay:!0}):e.jsx("img",{src:N.url,alt:N.name,className:"w-full h-full max-h-[80vh] object-contain"}))})})]})}const ee=[{value:"instagram",label:"Instagram",color:"bg-gradient-to-br from-purple-500 via-pink-500 to-orange-400"},{value:"facebook",label:"Facebook",color:"bg-blue-600"},{value:"youtube",label:"YouTube",color:"bg-red-600"},{value:"tiktok",label:"TikTok",color:"bg-black"},{value:"twitter",label:"X (Twitter)",color:"bg-gray-900"},{value:"linkedin",label:"LinkedIn",color:"bg-blue-700"},{value:"whatsapp",label:"WhatsApp",color:"bg-green-500"},{value:"telegram",label:"Telegram",color:"bg-blue-500"},{value:"pinterest",label:"Pinterest",color:"bg-red-500"},{value:"spotify",label:"Spotify",color:"bg-green-600"},{value:"website",label:"Website",color:"bg-gray-600"},{value:"other",label:"Outro",color:"bg-gray-500"}];function Ns(){const{user:k}=xe(),$=$e(),[A,re]=o.useState(""),[f,C]=o.useState(!1),[v,q]=o.useState(null),[T,U]=o.useState(null),[P,L]=o.useState("instagram"),[D,i]=o.useState(""),[M,b]=o.useState(""),[R,c]=o.useState(""),[S,N]=o.useState(null),[_,w]=o.useState([]),[I,O]=o.useState(!1),[le,V]=o.useState(!1),[G,B]=o.useState(null),[K,Q]=o.useState([]),{data:r=[],isLoading:t}=_e({queryKey:["external-links"],queryFn:async()=>{const{data:s,error:a}=await y.from("external_links").select("*").eq("user_id",k.id).order("created_at",{ascending:!1});if(a)throw a;return s},enabled:!!k}),n=me({mutationFn:async s=>{if(s.id){const{error:a}=await y.from("external_links").update({platform:s.platform,title:s.title,url:s.url,embed_code:s.embed_code||null}).eq("id",s.id);if(a)throw a}else{const{error:a}=await y.from("external_links").insert({user_id:k==null?void 0:k.id,platform:s.platform,title:s.title,url:s.url,embed_code:s.embed_code||null});if(a)throw a}},onSuccess:()=>{$.invalidateQueries({queryKey:["external-links"]}),l.success(v?"Link atualizado!":"Link adicionado!"),x()},onError:()=>{l.error("Erro ao salvar link")}}),m=me({mutationFn:async s=>{const{error:a}=await y.from("external_links").delete().eq("id",s);if(a)throw a},onSuccess:()=>{$.invalidateQueries({queryKey:["external-links"]}),l.success("Link removido!"),U(null)},onError:()=>{l.error("Erro ao remover link")}}),E=()=>{L("instagram"),i(""),b(""),c(""),q(null),N(null),w([]),B(null),Q([]),V(!1)},x=()=>{C(!1),E()},p=s=>{if(q(s),L(s.platform),i(s.title),b(s.url),c(s.embed_code||""),s.platform==="instagram"&&s.embed_code)try{const a=JSON.parse(s.embed_code);a.manual_profile&&B(a.manual_profile),a.manual_posts&&Q(a.manual_posts)}catch(a){console.error("Failed to parse embed_code for editing:",a)}N(null),w([]),C(!0)},X=(s,a)=>{if(a==="perfil")B(s[0].url),N(null),l.success("Foto de perfil selecionada da galeria!");else{const j=s.map(u=>({src:u.url,type:u.name.match(/\.(mp4|webm|mov)$/i)?"video":"image"}));Q(j),w([]),l.success(`${j.length} posts selecionados da galeria!`)}V(!1)},z=async(s,a)=>{if(!k)throw new Error("Usuário não autenticado");const j=s.name.split(".").pop(),u=s.name.replace(/[^a-zA-Z0-9]/g,"_"),h=`manual_${Date.now()}_${u}.${j}`,g=`${k.id}/social/${a}/${h}`,{error:Y}=await y.storage.from("media").upload(g,s,{upsert:!0});if(Y)throw console.error("[Upload] Supabase error:",Y),Y;const{data:Z}=y.storage.from("media").getPublicUrl(g);return Z.publicUrl},W=async s=>{if(s.preventDefault(),!D.trim()||!M.trim()){l.error("Preencha todos os campos obrigatórios");return}try{let a=R.trim();if(P==="instagram"){O(!0);const j={};let u=G;if(S)try{u=await z(S,"perfil")}catch(g){console.error("Profile upload failed:",g),l.error(`Erro ao enviar foto de perfil: ${g.message||"Erro desconhecido"}`),O(!1);return}u&&(j.manual_profile=u);let h=[...K];if(_.length>0)try{h=(await Promise.all(_.map(Z=>z(Z,"posts")))).map((Z,Pe)=>({src:Z,type:_[Pe].type.startsWith("video")?"video":"image"}))}catch(g){console.error("Posts upload failed:",g),l.error(`Erro ao enviar posts: ${g.message||"Erro desconhecido"}`),O(!1);return}h.length>0&&(j.manual_posts=h),Object.keys(j).length>0,a=JSON.stringify(j)}n.mutate({platform:P,title:D.trim(),url:M.trim(),embed_code:a})}catch(a){console.error(a),l.error(`Erro crítico no envio: ${a.message||"Tente novamente"}`)}finally{O(!1)}},J=r.filter(s=>s.title.toLowerCase().includes(A.toLowerCase())||s.platform.toLowerCase().includes(A.toLowerCase())||s.url.toLowerCase().includes(A.toLowerCase())),ke=ee.map(s=>({...s,links:J.filter(a=>a.platform===s.value)})),Ce=s=>ee.find(a=>a.value===s)||ee[ee.length-1];return t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(se,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold",children:"Links Externos"}),e.jsx("p",{className:"text-muted-foreground",children:"Conecte conteúdos de redes sociais e websites"})]})}),e.jsxs(ye,{defaultValue:"links",className:"w-full",children:[e.jsxs(Se,{className:"mb-6",children:[e.jsx(ae,{value:"links",children:"Meus Links"}),e.jsx(ae,{value:"gallery",children:"Galeria Social"})]}),e.jsxs(ue,{value:"links",className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"relative max-w-md w-full",children:[e.jsx(Xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(H,{placeholder:"Buscar links...",value:A,onChange:s=>re(s.target.value),className:"pl-10"})]}),e.jsxs(d,{className:"gradient-primary",onClick:()=>C(!0),children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Adicionar Link"]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3",children:ke.filter(s=>s.links.length>0).map(s=>e.jsx(te,{className:"glass hover:glow-primary transition-all duration-300",children:e.jsxs(ie,{className:"flex flex-col items-center justify-center p-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-full ${s.color} flex items-center justify-center mb-2`,children:e.jsx("span",{className:"text-white font-bold text-sm",children:s.label.charAt(0)})}),e.jsx("span",{className:"font-medium text-sm",children:s.label}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.links.length," links"]})]})},s.value))}),J.length>0?e.jsx("div",{className:"grid gap-4",children:J.map(s=>{const a=Ce(s.platform);return e.jsx(te,{className:"glass hover:glow-primary transition-all duration-300",children:e.jsxs(ie,{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg ${a.color} flex items-center justify-center flex-shrink-0`,children:e.jsx("span",{className:"text-white font-bold text-lg",children:a.label.charAt(0)})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"font-semibold truncate",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:a.label}),e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary hover:underline truncate block",children:s.url})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>window.open(s.url,"_blank"),children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>p(s),children:e.jsx(es,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>U(s.id),children:e.jsx(pe,{className:"h-4 w-4"})})]})]})},s.id)})}):e.jsx(te,{className:"glass",children:e.jsxs(ie,{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"p-6 rounded-full bg-muted/50 mb-4",children:e.jsx(Le,{className:"h-12 w-12 text-muted-foreground"})}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Nenhum link externo"}),e.jsx("p",{className:"text-muted-foreground text-center max-w-md mb-4",children:"Adicione links de Instagram, Facebook, YouTube, TikTok, WhatsApp e outras plataformas."}),e.jsxs(d,{className:"gradient-primary",onClick:()=>C(!0),children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Adicionar Link"]})]})}),e.jsx(he,{open:f,onOpenChange:C,children:e.jsxs(ge,{className:"max-h-[90vh] flex flex-col p-0 gap-0",children:[e.jsxs(qe,{className:"p-6 pb-2 shrink-0",children:[e.jsx(Te,{children:v?"Editar Link":"Adicionar Link"}),e.jsx(Ue,{children:"Adicione links de redes sociais para conectar seu conteúdo."})]}),e.jsxs("form",{onSubmit:W,className:"flex flex-col flex-1 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 pt-2 custom-scrollbar space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"platform",children:"Plataforma"}),e.jsxs(je,{value:P,onValueChange:L,children:[e.jsx(ve,{children:e.jsx(be,{placeholder:"Selecione a plataforma"})}),e.jsx(Ne,{children:ee.map(s=>e.jsx(we,{value:s.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-4 h-4 rounded ${s.color}`}),s.label]})},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"title",children:"Título *"}),e.jsx(H,{id:"title",value:D,onChange:s=>i(s.target.value),placeholder:"Ex: Nosso perfil no Instagram",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"url",children:"URL *"}),e.jsx(H,{id:"url",type:"url",value:M,onChange:s=>b(s.target.value),placeholder:"https://instagram.com/seuperfil",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"embed",children:P==="instagram"?"Configuração Manual (Opcional)":"Código de Embed (opcional)"}),P==="instagram"?e.jsx("div",{className:"space-y-4 border rounded-lg p-4 bg-muted/30",children:le?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(F,{className:"text-sm font-semibold",children:"Galeria Social"}),e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>V(!1),className:"h-6 px-2 text-xs",children:[e.jsx(de,{className:"h-4 w-4 mr-1"})," Fechar"]})]}),e.jsx(fe,{selectionMode:!0,onSelectionConfirm:X})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(d,{type:"button",variant:"secondary",size:"sm",onClick:()=>V(!0),className:"text-xs",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Selecionar da Galeria Social"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{className:"text-xs text-muted-foreground uppercase font-bold",children:"Foto Perfil do Instagram (Imagem)"}),G?e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-background rounded border",children:[e.jsx("img",{src:G,className:"w-10 h-10 rounded-full object-cover",alt:"Profile Selection"}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("p",{className:"text-xs truncate",children:"Selecionado da Galeria"})}),e.jsx(d,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>B(null),children:e.jsx(de,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{type:"file",accept:"image/*",onChange:s=>{var a;return N(((a=s.target.files)==null?void 0:a[0])||null)},className:"cursor-pointer text-xs"}),S&&e.jsx(oe,{className:"h-4 w-4 text-green-500"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{className:"text-xs text-muted-foreground uppercase font-bold",children:"Últimos 3 Posts (Img/Video)"}),K.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex gap-2",children:K.map((s,a)=>e.jsx("div",{className:"relative w-16 h-16 rounded overflow-hidden border bg-black/5",children:s.type==="video"?e.jsx("video",{src:s.src,className:"w-full h-full object-cover opacity-80",controls:!0}):e.jsx("img",{src:s.src,className:"w-full h-full object-cover",alt:"Post"})},a))}),e.jsx(d,{type:"button",variant:"outline",size:"sm",className:"w-full text-xs h-7",onClick:()=>Q([]),children:"Limpar Seleção de Posts"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{type:"file",accept:"image/*,video/*",multiple:!0,onChange:s=>{const a=Array.from(s.target.files||[]);if(a.length>3){l.error("Selecione no máximo 3 arquivos"),s.target.value="";return}w(a)},className:"cursor-pointer text-xs"}),e.jsx("div",{className:"flex gap-1",children:_.map((s,a)=>e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"},a))})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Suporta imagens e vídeos de até 1 minuto."})]})]})]})}):e.jsx(H,{id:"embed",value:R,onChange:s=>c(s.target.value),placeholder:"Código de incorporação da plataforma"})]})]}),e.jsxs("div",{className:"p-4 border-t bg-background mt-auto flex justify-end gap-2 shrink-0",children:[e.jsx(d,{type:"button",variant:"outline",onClick:x,children:"Cancelar"}),e.jsxs(d,{type:"submit",disabled:n.isPending||I,children:[n.isPending||I?e.jsx(se,{className:"h-4 w-4 animate-spin mr-2"}):null,v?"Salvar":"Adicionar"]})]})]})]})}),e.jsx(Be,{open:!!T,onOpenChange:()=>U(null),children:e.jsxs(Qe,{children:[e.jsxs(We,{children:[e.jsx(Je,{children:"Confirmar exclusão"}),e.jsx(He,{children:"Tem certeza que deseja excluir este link? Esta ação não pode ser desfeita."})]}),e.jsxs(Me,{children:[e.jsx(Re,{children:"Cancelar"}),e.jsx(Ke,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:()=>T&&m.mutate(T),children:"Excluir"})]})]})})]}),e.jsx(ue,{value:"gallery",children:e.jsx(fe,{availableLinks:r,onApplyToInstagram:async(s,a,j)=>{const u=r.find(h=>h.id===j);if(!u){l.error("O link selecionado não foi encontrado ou foi excluído.");return}try{let h={};try{h=u.embed_code?JSON.parse(u.embed_code):{}}catch{h={}}let g={...h};s==="profile"?(g.manual_profile=a,l.info(`Atualizando foto de perfil de "${u.title}"...`)):(g.manual_posts=a,l.info(`Atualizando posts de "${u.title}"...`)),await n.mutateAsync({...u,embed_code:JSON.stringify(g)}),l.success(s==="profile"?"Foto de perfil atualizada!":"Posts do Instagram atualizados!")}catch(h){console.error("Error updating instagram assets:",h),l.error("Erro ao atualizar Instagram.")}},isApplying:n.isPending})})]})]})}export{Ns as default};
