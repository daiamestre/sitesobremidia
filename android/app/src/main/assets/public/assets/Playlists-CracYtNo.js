import{c as le,u as ve,r as i,j as e,I as Z,B as z,X as Dr,x as C,s as T,z as K,o as ze,p as $,E as ne,F as U,G as X,H as Ar,q as ee,J as we,R as G,K as Rr,g as Ir,C as Lr,N as re,O as Ge,P as ge,y as Mr}from"./index-BIw4YUGd.js";import{C as zr,d as Gr}from"./card-CV21M-nN.js";import{I as Y}from"./input-ClxgF6ef.js";import{B as Or}from"./badge-txkClHpg.js";import{D as Wr,a as Vr,b as Fr,c as me}from"./dropdown-menu-yikGsMbg.js";import{A as Hr,a as Ur,b as $r,c as Br,d as qr,e as Xr,f as Yr,g as Qr}from"./alert-dialog-fpOX6zNm.js";import{D as Oe,a as We,b as Ve,c as Fe,T as He,S as fe,E as Kr}from"./skeleton-CNJ59E-z.js";import{L as F}from"./label-CZ2eJaUL.js";import{T as Jr}from"./textarea-B0nlxmw9.js";import{S as Zr}from"./switch-Cnwh7C_o.js";import{U as et}from"./upload-B64iRs8f.js";import{u as Ue,c as $e,I as rt,R as tt}from"./index-DHwCTHmR.js";import{c as st,u as at}from"./index-LZhMg3qy.js";import{T as ot,a as lt,b as he,c as pe}from"./tabs-BLxlA1-_.js";import{P as nt,a as it,b as ct,M as dt}from"./popover-Cun9Wyz3.js";import{C as Be}from"./clock-icWLYuK5.js";import{V as qe}from"./video-CEtQmOzZ.js";import{N as ut,C as mt}from"./newspaper-CjUqlY84.js";import{u as ft}from"./useQuery-BY5vm64i.js";import{S as ht}from"./search-Dx2gYc4E.js";import{E as pt}from"./ellipsis-vertical-BFraEyc3.js";import{P as xt}from"./pencil-BQaEiLha.js";import{f as gt,p as vt}from"./pt-BR-0dgV4ihQ.js";import"./index-Db6mGbV6.js";import"./check-D1yzJIhg.js";import"./index-e1UCY7pb.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=le("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=le("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=le("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=le("ListMusic",[["path",{d:"M21 15V6",key:"h1cx4g"}],["path",{d:"M18.5 18a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z",key:"8saifv"}],["path",{d:"M12 12H3",key:"18klou"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M12 18H3",key:"11ftsu"}]]);function yt({open:r,onOpenChange:o,playlist:t,onSaved:n}){const{user:s}=ve(),[l,d]=i.useState(""),[c,u]=i.useState(""),[x,m]=i.useState(!0),[h,p]=i.useState(!1),[w,y]=i.useState(null),[_,I]=i.useState(null),[k,D]=i.useState(null),[A,M]=i.useState(!1),P=i.useRef(null);i.useEffect(()=>{t?(d(t.name),u(t.description||""),m(t.is_active),y(t.cover_url||null),D(t.cover_url||null)):(d(""),u(""),m(!0),y(null),D(null)),I(null)},[t,r]);const v=b=>{var H;const S=(H=b.target.files)==null?void 0:H[0];if(S){if(!S.type.startsWith("image/")){C.error("Por favor, selecione uma imagem");return}I(S),D(URL.createObjectURL(S))}},R=()=>{I(null),D(null),y(null),P.current&&(P.current.value="")},O=async()=>{if(!_||!s)return w;M(!0);try{const b=_.name.split(".").pop(),S=`${Date.now()}-cover.${b}`,H=`${s.id}/covers/${S}`,{error:J}=await T.storage.from("media").upload(H,_,{cacheControl:"3600",upsert:!1});if(J)throw J;const{data:{publicUrl:de}}=T.storage.from("media").getPublicUrl(H);return de}catch(b){return console.error("Error uploading cover:",b),C.error("Erro ao fazer upload da capa"),null}finally{M(!1)}},N=async()=>{if(s){if(!l.trim()){C.error("Nome é obrigatório");return}p(!0);try{let b=w;if(_?b=await O():!k&&w&&(b=null),t){const{error:S}=await T.from("playlists").update({name:l,description:c,is_active:x,cover_url:b}).eq("id",t.id);if(S)throw S;C.success("Playlist atualizada!")}else{const{error:S}=await T.from("playlists").insert({user_id:s.id,name:l,description:c,is_active:x,cover_url:b});if(S)throw S;C.success("Playlist criada!")}n(),o(!1)}catch(b){console.error("Error saving playlist:",b),C.error("Erro ao salvar playlist")}finally{p(!1)}}};return e.jsx(Oe,{open:r,onOpenChange:o,children:e.jsxs(We,{className:"max-h-[85vh] flex flex-col p-0 gap-0",children:[e.jsx(Ve,{className:"p-6 pb-2 shrink-0",children:e.jsx(Fe,{children:t?"Editar Playlist":"Nova Playlist"})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 pt-2 custom-scrollbar space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"name",children:"Nome da Playlist"}),e.jsx(Y,{id:"name",value:l,onChange:b=>d(b.target.value),placeholder:"Ex: Manhã, Ofertas, Institucional"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"description",children:"Descrição (Opcional)"}),e.jsx(Jr,{id:"description",value:c,onChange:b=>u(b.target.value),placeholder:"Uma breve descrição sobre o conteúdo..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Capa da Playlist"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-24 h-24 rounded-lg bg-muted flex items-center justify-center border-2 border-dashed overflow-hidden relative cursor-pointer hover:bg-muted/80 transition-colors",onClick:()=>{var b;return(b=P.current)==null?void 0:b.click()},children:k?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:k,alt:"Capa",className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:e.jsx(et,{className:"h-6 w-6 text-white"})})]}):e.jsxs("div",{className:"flex flex-col items-center gap-1 text-muted-foreground",children:[e.jsx(Z,{className:"h-8 w-8"}),e.jsx("span",{className:"text-[10px]",children:"Alterar"})]})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(Y,{ref:P,type:"file",accept:"image/*",onChange:v,className:"hidden"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsx("p",{children:"Selecione uma imagem para identificar a playlist."}),e.jsx("p",{className:"text-xs mt-1",children:"Formatos aceitos: JPG, PNG, WEBP"})]}),k&&e.jsxs(z,{variant:"outline",size:"sm",onClick:R,className:"h-8 text-xs text-destructive hover:text-destructive",children:[e.jsx(Dr,{className:"h-3 w-3 mr-1"}),"Remover Capa"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between border rounded-lg p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(F,{children:"Playlist Ativa"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Se desativada, não aparecerá nas telas vinculadas"})]}),e.jsx(Zr,{checked:x,onCheckedChange:m})]})]}),e.jsxs("div",{className:"p-4 border-t bg-background mt-auto flex justify-end gap-2 shrink-0",children:[e.jsx(z,{variant:"outline",onClick:()=>o(!1),children:"Cancelar"}),e.jsx(z,{onClick:N,disabled:h||A,children:h||A?"Salvando...":"Salvar"})]})]})})}function Nt(r,o){return i.useReducer((t,n)=>o[t][n]??t,r)}var be="ScrollArea",[Xe]=ze(be),[St,L]=Xe(be),Ye=i.forwardRef((r,o)=>{const{__scopeScrollArea:t,type:n="hover",dir:s,scrollHideDelay:l=600,...d}=r,[c,u]=i.useState(null),[x,m]=i.useState(null),[h,p]=i.useState(null),[w,y]=i.useState(null),[_,I]=i.useState(null),[k,D]=i.useState(0),[A,M]=i.useState(0),[P,v]=i.useState(!1),[R,O]=i.useState(!1),N=K(o,S=>u(S)),b=Ue(s);return e.jsx(St,{scope:t,type:n,dir:b,scrollHideDelay:l,scrollArea:c,viewport:x,onViewportChange:m,content:h,onContentChange:p,scrollbarX:w,onScrollbarXChange:y,scrollbarXEnabled:P,onScrollbarXEnabledChange:v,scrollbarY:_,onScrollbarYChange:I,scrollbarYEnabled:R,onScrollbarYEnabledChange:O,onCornerWidthChange:D,onCornerHeightChange:M,children:e.jsx($.div,{dir:b,...d,ref:N,style:{position:"relative","--radix-scroll-area-corner-width":k+"px","--radix-scroll-area-corner-height":A+"px",...r.style}})})});Ye.displayName=be;var Qe="ScrollAreaViewport",Ke=i.forwardRef((r,o)=>{const{__scopeScrollArea:t,children:n,nonce:s,...l}=r,d=L(Qe,t),c=i.useRef(null),u=K(o,c,d.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),e.jsx($.div,{"data-radix-scroll-area-viewport":"",...l,ref:u,style:{overflowX:d.scrollbarXEnabled?"scroll":"hidden",overflowY:d.scrollbarYEnabled?"scroll":"hidden",...r.style},children:e.jsx("div",{ref:d.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});Ke.displayName=Qe;var V="ScrollAreaScrollbar",je=i.forwardRef((r,o)=>{const{forceMount:t,...n}=r,s=L(V,r.__scopeScrollArea),{onScrollbarXEnabledChange:l,onScrollbarYEnabledChange:d}=s,c=r.orientation==="horizontal";return i.useEffect(()=>(c?l(!0):d(!0),()=>{c?l(!1):d(!1)}),[c,l,d]),s.type==="hover"?e.jsx(Ct,{...n,ref:o,forceMount:t}):s.type==="scroll"?e.jsx(_t,{...n,ref:o,forceMount:t}):s.type==="auto"?e.jsx(Je,{...n,ref:o,forceMount:t}):s.type==="always"?e.jsx(ye,{...n,ref:o}):null});je.displayName=V;var Ct=i.forwardRef((r,o)=>{const{forceMount:t,...n}=r,s=L(V,r.__scopeScrollArea),[l,d]=i.useState(!1);return i.useEffect(()=>{const c=s.scrollArea;let u=0;if(c){const x=()=>{window.clearTimeout(u),d(!0)},m=()=>{u=window.setTimeout(()=>d(!1),s.scrollHideDelay)};return c.addEventListener("pointerenter",x),c.addEventListener("pointerleave",m),()=>{window.clearTimeout(u),c.removeEventListener("pointerenter",x),c.removeEventListener("pointerleave",m)}}},[s.scrollArea,s.scrollHideDelay]),e.jsx(ne,{present:t||l,children:e.jsx(Je,{"data-state":l?"visible":"hidden",...n,ref:o})})}),_t=i.forwardRef((r,o)=>{const{forceMount:t,...n}=r,s=L(V,r.__scopeScrollArea),l=r.orientation==="horizontal",d=ce(()=>u("SCROLL_END"),100),[c,u]=Nt("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return i.useEffect(()=>{if(c==="idle"){const x=window.setTimeout(()=>u("HIDE"),s.scrollHideDelay);return()=>window.clearTimeout(x)}},[c,s.scrollHideDelay,u]),i.useEffect(()=>{const x=s.viewport,m=l?"scrollLeft":"scrollTop";if(x){let h=x[m];const p=()=>{const w=x[m];h!==w&&(u("SCROLL"),d()),h=w};return x.addEventListener("scroll",p),()=>x.removeEventListener("scroll",p)}},[s.viewport,l,u,d]),e.jsx(ne,{present:t||c!=="hidden",children:e.jsx(ye,{"data-state":c==="hidden"?"hidden":"visible",...n,ref:o,onPointerEnter:U(r.onPointerEnter,()=>u("POINTER_ENTER")),onPointerLeave:U(r.onPointerLeave,()=>u("POINTER_LEAVE"))})})}),Je=i.forwardRef((r,o)=>{const t=L(V,r.__scopeScrollArea),{forceMount:n,...s}=r,[l,d]=i.useState(!1),c=r.orientation==="horizontal",u=ce(()=>{if(t.viewport){const x=t.viewport.offsetWidth<t.viewport.scrollWidth,m=t.viewport.offsetHeight<t.viewport.scrollHeight;d(c?x:m)}},10);return Q(t.viewport,u),Q(t.content,u),e.jsx(ne,{present:n||l,children:e.jsx(ye,{"data-state":l?"visible":"hidden",...s,ref:o})})}),ye=i.forwardRef((r,o)=>{const{orientation:t="vertical",...n}=r,s=L(V,r.__scopeScrollArea),l=i.useRef(null),d=i.useRef(0),[c,u]=i.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),x=sr(c.viewport,c.content),m={...n,sizes:c,onSizesChange:u,hasThumb:x>0&&x<1,onThumbChange:p=>l.current=p,onThumbPointerUp:()=>d.current=0,onThumbPointerDown:p=>d.current=p};function h(p,w){return At(p,d.current,c,w)}return t==="horizontal"?e.jsx(Pt,{...m,ref:o,onThumbPositionChange:()=>{if(s.viewport&&l.current){const p=s.viewport.scrollLeft,w=Te(p,c,s.dir);l.current.style.transform=`translate3d(${w}px, 0, 0)`}},onWheelScroll:p=>{s.viewport&&(s.viewport.scrollLeft=p)},onDragScroll:p=>{s.viewport&&(s.viewport.scrollLeft=h(p,s.dir))}}):t==="vertical"?e.jsx(Et,{...m,ref:o,onThumbPositionChange:()=>{if(s.viewport&&l.current){const p=s.viewport.scrollTop,w=Te(p,c);l.current.style.transform=`translate3d(0, ${w}px, 0)`}},onWheelScroll:p=>{s.viewport&&(s.viewport.scrollTop=p)},onDragScroll:p=>{s.viewport&&(s.viewport.scrollTop=h(p))}}):null}),Pt=i.forwardRef((r,o)=>{const{sizes:t,onSizesChange:n,...s}=r,l=L(V,r.__scopeScrollArea),[d,c]=i.useState(),u=i.useRef(null),x=K(o,u,l.onScrollbarXChange);return i.useEffect(()=>{u.current&&c(getComputedStyle(u.current))},[u]),e.jsx(er,{"data-orientation":"horizontal",...s,ref:x,sizes:t,style:{bottom:0,left:l.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:l.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":ie(t)+"px",...r.style},onThumbPointerDown:m=>r.onThumbPointerDown(m.x),onDragScroll:m=>r.onDragScroll(m.x),onWheelScroll:(m,h)=>{if(l.viewport){const p=l.viewport.scrollLeft+m.deltaX;r.onWheelScroll(p),or(p,h)&&m.preventDefault()}},onResize:()=>{u.current&&l.viewport&&d&&n({content:l.viewport.scrollWidth,viewport:l.viewport.offsetWidth,scrollbar:{size:u.current.clientWidth,paddingStart:ae(d.paddingLeft),paddingEnd:ae(d.paddingRight)}})}})}),Et=i.forwardRef((r,o)=>{const{sizes:t,onSizesChange:n,...s}=r,l=L(V,r.__scopeScrollArea),[d,c]=i.useState(),u=i.useRef(null),x=K(o,u,l.onScrollbarYChange);return i.useEffect(()=>{u.current&&c(getComputedStyle(u.current))},[u]),e.jsx(er,{"data-orientation":"vertical",...s,ref:x,sizes:t,style:{top:0,right:l.dir==="ltr"?0:void 0,left:l.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":ie(t)+"px",...r.style},onThumbPointerDown:m=>r.onThumbPointerDown(m.y),onDragScroll:m=>r.onDragScroll(m.y),onWheelScroll:(m,h)=>{if(l.viewport){const p=l.viewport.scrollTop+m.deltaY;r.onWheelScroll(p),or(p,h)&&m.preventDefault()}},onResize:()=>{u.current&&l.viewport&&d&&n({content:l.viewport.scrollHeight,viewport:l.viewport.offsetHeight,scrollbar:{size:u.current.clientHeight,paddingStart:ae(d.paddingTop),paddingEnd:ae(d.paddingBottom)}})}})}),[Tt,Ze]=Xe(V),er=i.forwardRef((r,o)=>{const{__scopeScrollArea:t,sizes:n,hasThumb:s,onThumbChange:l,onThumbPointerUp:d,onThumbPointerDown:c,onThumbPositionChange:u,onDragScroll:x,onWheelScroll:m,onResize:h,...p}=r,w=L(V,t),[y,_]=i.useState(null),I=K(o,N=>_(N)),k=i.useRef(null),D=i.useRef(""),A=w.viewport,M=n.content-n.viewport,P=X(m),v=X(u),R=ce(h,10);function O(N){if(k.current){const b=N.clientX-k.current.left,S=N.clientY-k.current.top;x({x:b,y:S})}}return i.useEffect(()=>{const N=b=>{const S=b.target;(y==null?void 0:y.contains(S))&&P(b,M)};return document.addEventListener("wheel",N,{passive:!1}),()=>document.removeEventListener("wheel",N,{passive:!1})},[A,y,M,P]),i.useEffect(v,[n,v]),Q(y,R),Q(w.content,R),e.jsx(Tt,{scope:t,scrollbar:y,hasThumb:s,onThumbChange:X(l),onThumbPointerUp:X(d),onThumbPositionChange:v,onThumbPointerDown:X(c),children:e.jsx($.div,{...p,ref:I,style:{position:"absolute",...p.style},onPointerDown:U(r.onPointerDown,N=>{N.button===0&&(N.target.setPointerCapture(N.pointerId),k.current=y.getBoundingClientRect(),D.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",w.viewport&&(w.viewport.style.scrollBehavior="auto"),O(N))}),onPointerMove:U(r.onPointerMove,O),onPointerUp:U(r.onPointerUp,N=>{const b=N.target;b.hasPointerCapture(N.pointerId)&&b.releasePointerCapture(N.pointerId),document.body.style.webkitUserSelect=D.current,w.viewport&&(w.viewport.style.scrollBehavior=""),k.current=null})})})}),se="ScrollAreaThumb",rr=i.forwardRef((r,o)=>{const{forceMount:t,...n}=r,s=Ze(se,r.__scopeScrollArea);return e.jsx(ne,{present:t||s.hasThumb,children:e.jsx(kt,{ref:o,...n})})}),kt=i.forwardRef((r,o)=>{const{__scopeScrollArea:t,style:n,...s}=r,l=L(se,t),d=Ze(se,t),{onThumbPositionChange:c}=d,u=K(o,h=>d.onThumbChange(h)),x=i.useRef(void 0),m=ce(()=>{x.current&&(x.current(),x.current=void 0)},100);return i.useEffect(()=>{const h=l.viewport;if(h){const p=()=>{if(m(),!x.current){const w=Rt(h,c);x.current=w,c()}};return c(),h.addEventListener("scroll",p),()=>h.removeEventListener("scroll",p)}},[l.viewport,m,c]),e.jsx($.div,{"data-state":d.hasThumb?"visible":"hidden",...s,ref:u,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:U(r.onPointerDownCapture,h=>{const w=h.target.getBoundingClientRect(),y=h.clientX-w.left,_=h.clientY-w.top;d.onThumbPointerDown({x:y,y:_})}),onPointerUp:U(r.onPointerUp,d.onThumbPointerUp)})});rr.displayName=se;var Ne="ScrollAreaCorner",tr=i.forwardRef((r,o)=>{const t=L(Ne,r.__scopeScrollArea),n=!!(t.scrollbarX&&t.scrollbarY);return t.type!=="scroll"&&n?e.jsx(Dt,{...r,ref:o}):null});tr.displayName=Ne;var Dt=i.forwardRef((r,o)=>{const{__scopeScrollArea:t,...n}=r,s=L(Ne,t),[l,d]=i.useState(0),[c,u]=i.useState(0),x=!!(l&&c);return Q(s.scrollbarX,()=>{var h;const m=((h=s.scrollbarX)==null?void 0:h.offsetHeight)||0;s.onCornerHeightChange(m),u(m)}),Q(s.scrollbarY,()=>{var h;const m=((h=s.scrollbarY)==null?void 0:h.offsetWidth)||0;s.onCornerWidthChange(m),d(m)}),x?e.jsx($.div,{...n,ref:o,style:{width:l,height:c,position:"absolute",right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:0,...r.style}}):null});function ae(r){return r?parseInt(r,10):0}function sr(r,o){const t=r/o;return isNaN(t)?0:t}function ie(r){const o=sr(r.viewport,r.content),t=r.scrollbar.paddingStart+r.scrollbar.paddingEnd,n=(r.scrollbar.size-t)*o;return Math.max(n,18)}function At(r,o,t,n="ltr"){const s=ie(t),l=s/2,d=o||l,c=s-d,u=t.scrollbar.paddingStart+d,x=t.scrollbar.size-t.scrollbar.paddingEnd-c,m=t.content-t.viewport,h=n==="ltr"?[0,m]:[m*-1,0];return ar([u,x],h)(r)}function Te(r,o,t="ltr"){const n=ie(o),s=o.scrollbar.paddingStart+o.scrollbar.paddingEnd,l=o.scrollbar.size-s,d=o.content-o.viewport,c=l-n,u=t==="ltr"?[0,d]:[d*-1,0],x=st(r,u);return ar([0,d],[0,c])(x)}function ar(r,o){return t=>{if(r[0]===r[1]||o[0]===o[1])return o[0];const n=(o[1]-o[0])/(r[1]-r[0]);return o[0]+n*(t-r[0])}}function or(r,o){return r>0&&r<o}var Rt=(r,o=()=>{})=>{let t={left:r.scrollLeft,top:r.scrollTop},n=0;return function s(){const l={left:r.scrollLeft,top:r.scrollTop},d=t.left!==l.left,c=t.top!==l.top;(d||c)&&o(),t=l,n=window.requestAnimationFrame(s)}(),()=>window.cancelAnimationFrame(n)};function ce(r,o){const t=X(r),n=i.useRef(0);return i.useEffect(()=>()=>window.clearTimeout(n.current),[]),i.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(t,o)},[t,o])}function Q(r,o){const t=X(o);Ar(()=>{let n=0;if(r){const s=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(t)});return s.observe(r),()=>{window.cancelAnimationFrame(n),s.unobserve(r)}}},[r,t])}var lr=Ye,It=Ke,Lt=tr;const te=i.forwardRef(({className:r,children:o,...t},n)=>e.jsxs(lr,{ref:n,className:ee("relative overflow-hidden",r),...t,children:[e.jsx(It,{className:"h-full w-full rounded-[inherit]",children:o}),e.jsx(nr,{}),e.jsx(Lt,{})]}));te.displayName=lr.displayName;const nr=i.forwardRef(({className:r,orientation:o="vertical",...t},n)=>e.jsx(je,{ref:n,orientation:o,className:ee("flex touch-none select-none transition-colors",o==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",o==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...t,children:e.jsx(rr,{className:"relative flex-1 rounded-full bg-border"})}));nr.displayName=je.displayName;var ir="Toggle",Se=i.forwardRef((r,o)=>{const{pressed:t,defaultPressed:n,onPressedChange:s,...l}=r,[d,c]=we({prop:t,onChange:s,defaultProp:n??!1,caller:ir});return e.jsx($.button,{type:"button","aria-pressed":d,"data-state":d?"on":"off","data-disabled":r.disabled?"":void 0,...l,ref:o,onClick:U(r.onClick,()=>{r.disabled||c(!d)})})});Se.displayName=ir;var cr=Se,B="ToggleGroup",[dr]=ze(B,[$e]),ur=$e(),Ce=G.forwardRef((r,o)=>{const{type:t,...n}=r;if(t==="single"){const s=n;return e.jsx(Mt,{...s,ref:o})}if(t==="multiple"){const s=n;return e.jsx(zt,{...s,ref:o})}throw new Error(`Missing prop \`type\` expected on \`${B}\``)});Ce.displayName=B;var[mr,fr]=dr(B),Mt=G.forwardRef((r,o)=>{const{value:t,defaultValue:n,onValueChange:s=()=>{},...l}=r,[d,c]=we({prop:t,defaultProp:n??"",onChange:s,caller:B});return e.jsx(mr,{scope:r.__scopeToggleGroup,type:"single",value:G.useMemo(()=>d?[d]:[],[d]),onItemActivate:c,onItemDeactivate:G.useCallback(()=>c(""),[c]),children:e.jsx(hr,{...l,ref:o})})}),zt=G.forwardRef((r,o)=>{const{value:t,defaultValue:n,onValueChange:s=()=>{},...l}=r,[d,c]=we({prop:t,defaultProp:n??[],onChange:s,caller:B}),u=G.useCallback(m=>c((h=[])=>[...h,m]),[c]),x=G.useCallback(m=>c((h=[])=>h.filter(p=>p!==m)),[c]);return e.jsx(mr,{scope:r.__scopeToggleGroup,type:"multiple",value:d,onItemActivate:u,onItemDeactivate:x,children:e.jsx(hr,{...l,ref:o})})});Ce.displayName=B;var[Gt,Ot]=dr(B),hr=G.forwardRef((r,o)=>{const{__scopeToggleGroup:t,disabled:n=!1,rovingFocus:s=!0,orientation:l,dir:d,loop:c=!0,...u}=r,x=ur(t),m=Ue(d),h={role:"group",dir:m,...u};return e.jsx(Gt,{scope:t,rovingFocus:s,disabled:n,children:s?e.jsx(tt,{asChild:!0,...x,orientation:l,dir:m,loop:c,children:e.jsx($.div,{...h,ref:o})}):e.jsx($.div,{...h,ref:o})})}),oe="ToggleGroupItem",pr=G.forwardRef((r,o)=>{const t=fr(oe,r.__scopeToggleGroup),n=Ot(oe,r.__scopeToggleGroup),s=ur(r.__scopeToggleGroup),l=t.value.includes(r.value),d=n.disabled||r.disabled,c={...r,pressed:l,disabled:d},u=G.useRef(null);return n.rovingFocus?e.jsx(rt,{asChild:!0,...s,focusable:!d,active:l,ref:u,children:e.jsx(ke,{...c,ref:o})}):e.jsx(ke,{...c,ref:o})});pr.displayName=oe;var ke=G.forwardRef((r,o)=>{const{__scopeToggleGroup:t,value:n,...s}=r,l=fr(oe,t),d={role:"radio","aria-checked":r.pressed,"aria-pressed":void 0},c=l.type==="single"?d:void 0;return e.jsx(Se,{...c,...s,ref:o,onPressedChange:u=>{u?l.onItemActivate(n):l.onItemDeactivate(n)}})}),xr=Ce,gr=pr;const vr=Rr("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}}),Wt=i.forwardRef(({className:r,variant:o,size:t,...n},s)=>e.jsx(cr,{ref:s,className:ee(vr({variant:o,size:t,className:r})),...n}));Wt.displayName=cr.displayName;const wr=i.createContext({size:"default",variant:"default"}),br=i.forwardRef(({className:r,variant:o,size:t,children:n,...s},l)=>e.jsx(xr,{ref:l,className:ee("flex items-center justify-center gap-1",r),...s,children:e.jsx(wr.Provider,{value:{variant:o,size:t},children:n})}));br.displayName=xr.displayName;const jr=i.forwardRef(({className:r,children:o,variant:t,size:n,...s},l)=>{const d=i.useContext(wr);return e.jsx(gr,{ref:l,className:ee(vr({variant:d.variant||t,size:d.size||n}),r),...s,children:o})});jr.displayName=gr.displayName;const De=r=>{switch(r){case"image":return e.jsx(Z,{className:"h-5 w-5 text-primary"});case"video":return e.jsx(qe,{className:"h-5 w-5 text-accent"});case"audio":return e.jsx(dt,{className:"h-5 w-5 text-success"});default:return e.jsx(Z,{className:"h-5 w-5 text-muted-foreground"})}},Ae=r=>{switch(r){case"clock":return"Relógio";case"weather":return"Clima";case"rss":return"Notícias";default:return"Widget"}},Re=()=>{const[r,o]=i.useState(new Date);return i.useEffect(()=>{const t=setInterval(()=>o(new Date),1e3);return()=>clearInterval(t)},[]),e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-primary",children:r.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})})})},Ie=()=>e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-blue-500/20 to-blue-500/5 flex items-center justify-center",children:e.jsx(mt,{className:"h-5 w-5 text-blue-500"})}),Le=()=>e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-orange-500/20 to-orange-500/5 flex items-center justify-center",children:e.jsx(ut,{className:"h-5 w-5 text-orange-500"})}),Vt=r=>{const o=r.match(/instagram\.com\/p\/([^/?#&]+)/);return o?`https://www.instagram.com/p/${o[1]}/media/?size=t`:null},Me=({link:r})=>{const[o,t]=i.useState(!1);let n=r.thumbnail_url;if(!n&&r.platform.toLowerCase().includes("instagram")&&(n=Vt(r.url)),n&&!o)return e.jsx("img",{src:n,alt:"",className:"w-full h-full object-cover",onError:()=>t(!0)});const s=r.platform.toLowerCase();return s.includes("instagram")?e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-pink-500/30 via-purple-500/30 to-orange-500/30 flex items-center justify-center",children:e.jsx("span",{className:"text-[10px] font-bold text-white",children:"IG"})}):s.includes("youtube")?e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-red-500/30 to-red-600/30 flex items-center justify-center",children:e.jsx("span",{className:"text-[10px] font-bold text-white",children:"YT"})}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-purple-500/20 to-purple-500/5 flex items-center justify-center",children:e.jsx(Ge,{className:"h-5 w-5 text-purple-500"})})};function Ft({open:r,onOpenChange:o,playlist:t}){const{user:n}=ve(),[s,l]=i.useState([]),[d,c]=i.useState([]),[u,x]=i.useState([]),[m,h]=i.useState([]),[p,w]=i.useState(!0),[y,_]=i.useState(!1),[I,k]=i.useState("media"),[D,A]=i.useState(null),[M,P]=i.useState(null),v=async()=>{if(!(!t||!n)){w(!0);try{const{data:a,error:f}=await T.from("playlist_items").select("*, media:media_id(*), widget:widget_id(*), external_link:external_link_id(*)").eq("playlist_id",t.id).order("position");if(f)throw f;l(a||[]);const{data:j,error:g}=await T.from("media").select("*").order("created_at",{ascending:!1});if(g)throw g;c(j||[]);const{data:E,error:W}=await T.from("widgets").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(W)throw W;x(E||[]);const{data:q,error:Ee}=await T.from("external_links").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(Ee)throw Ee;h(q||[])}catch(a){console.error("Error fetching data:",a),C.error("Erro ao carregar dados")}finally{w(!1)}}};i.useEffect(()=>{r&&t&&v()},[r,t]);const R=i.useCallback(async a=>{try{const f=a.map((j,g)=>T.from("playlist_items").update({position:g}).eq("id",j.id));await Promise.all(f)}catch(f){console.error("Error updating positions:",f),C.error("Erro ao atualizar posições")}},[]),O=(a,f)=>{A(f),a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text/html","")},N=(a,f)=>{a.preventDefault(),a.dataTransfer.dropEffect="move",P(f)},b=()=>{P(null)},S=async(a,f)=>{if(a.preventDefault(),D===null||D===f){A(null),P(null);return}const j=[...s],[g]=j.splice(D,1);j.splice(f,0,g);const E=j.map((W,q)=>({...W,position:q}));l(E),await R(E),C.success("Ordem atualizada!"),A(null),P(null)},H=()=>{A(null),P(null)},J=async(a,f)=>{if(f<0||f>=s.length)return;const j=[...s],[g]=j.splice(a,1);j.splice(f,0,g);const E=j.map((W,q)=>({...W,position:q}));l(E),await R(E),C.success("Ordem atualizada!")},de=async a=>{if(t)try{const f=s.length,{data:j,error:g}=await T.from("playlist_items").insert({playlist_id:t.id,media_id:a.id,widget_id:null,external_link_id:null,position:f,duration:a.file_type==="video"?0:10}).select("*, media:media_id(*), widget:widget_id(*), external_link:external_link_id(*)").single();if(g)throw g;l([...s,j]),_(!1),C.success("Mídia adicionada!")}catch(f){console.error("Error adding media:",f),C.error("Erro ao adicionar mídia: "+(f.message||"Erro desconhecido"))}},yr=async a=>{if(t)try{const f=s.length,{data:j,error:g}=await T.from("playlist_items").insert({playlist_id:t.id,media_id:null,widget_id:a.id,external_link_id:null,position:f,duration:15}).select("*, media:media_id(*), widget:widget_id(*), external_link:external_link_id(*)").single();if(g)throw g;l([...s,j]),_(!1),C.success("Widget adicionado!")}catch(f){console.error("Error adding widget:",f),C.error("Erro ao adicionar widget: "+(f.message||"Erro desconhecido"))}},Nr=async a=>{if(t)try{const f=s.length,{data:j,error:g}=await T.from("playlist_items").insert({playlist_id:t.id,media_id:null,widget_id:null,external_link_id:a.id,position:f,duration:30}).select("*, media:media_id(*), widget:widget_id(*), external_link:external_link_id(*)").single();if(g)throw g;l([...s,j]),_(!1),C.success("Link externo adicionado!")}catch(f){console.error("Error adding external link:",f),C.error("Erro ao adicionar link externo: "+(f.message||"Erro desconhecido"))}},Sr=async a=>{try{const{error:f}=await T.from("playlist_items").delete().eq("id",a);if(f)throw f;const g=s.filter(E=>E.id!==a).map((E,W)=>({...E,position:W}));l(g),await R(g),C.success("Item removido!")}catch(f){console.error("Error removing item:",f),C.error("Erro ao remover item")}},Cr=async(a,f)=>{try{const{error:j}=await T.from("playlist_items").update({duration:f}).eq("id",a);if(j)throw j;l(s.map(g=>g.id===a?{...g,duration:f}:g))}catch(j){console.error("Error updating duration:",j)}},ue=async(a,f)=>{try{const{error:j}=await T.from("playlist_items").update(f).eq("id",a);if(j)throw j;l(s.map(g=>g.id===a?{...g,...f}:g))}catch(j){console.error("Error updating schedule:",j),C.error("Erro ao atualizar agendamento")}},_r=s.reduce((a,f)=>a+f.duration,0),Pr=a=>{const f=Math.floor(a/60),j=a%60;return`${f}:${j.toString().padStart(2,"0")}`},Er=s.filter(a=>a.media_id).map(a=>a.media_id),_e=d.filter(a=>!Er.includes(a.id)),Tr=a=>a.media?a.media.name:a.widget?a.widget.name:a.external_link?a.external_link.title:"Item desconhecido",kr=a=>{if(a.media)return a.media.file_type==="image"?e.jsx("img",{src:a.media.file_url,alt:"",className:"w-full h-full object-cover"}):a.media.file_type==="video"?a.media.thumbnail_url?e.jsx("img",{src:a.media.thumbnail_url,alt:"",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-accent/20 to-accent/5 flex items-center justify-center relative",children:e.jsx(qe,{className:"h-5 w-5 text-accent"})}):De(a.media.file_type);if(a.widget)switch(a.widget.widget_type){case"clock":return e.jsx(Re,{});case"weather":return e.jsx(Ie,{});case"rss":return e.jsx(Le,{});default:return e.jsx(re,{className:"h-5 w-5 text-muted-foreground"})}return a.external_link?e.jsx(Me,{link:a.external_link}):e.jsx(re,{className:"h-5 w-5 text-muted-foreground"})},Pe=a=>a.widget?Ae(a.widget.widget_type):a.external_link?a.external_link.platform:null;return t?e.jsx(Oe,{open:r,onOpenChange:o,children:e.jsxs(We,{className:"sm:max-w-2xl max-h-[85vh] flex flex-col p-0 gap-0",children:[e.jsx(Ve,{className:"p-6 pb-2 shrink-0",children:e.jsxs(Fe,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:['Itens em "',t.name,'"']}),e.jsxs("span",{className:"text-sm font-normal text-muted-foreground flex items-center gap-1",children:[e.jsx(Be,{className:"h-4 w-4"}),"Total: ",Pr(_r)]})]})}),p?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(Ir,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-1 overflow-y-auto p-6 pt-2 custom-scrollbar",children:s.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Nenhum item na playlist. Adicione mídias, widgets ou links abaixo."}):e.jsxs("div",{className:"space-y-2",children:[s.length>0&&e.jsx("p",{className:"text-xs text-muted-foreground text-center mb-2",children:"Arraste os itens para reordenar ou use as setas"}),s.map((a,f)=>{var j;return e.jsxs("div",{draggable:!0,onDragStart:g=>O(g,f),onDragOver:g=>N(g,f),onDragLeave:b,onDrop:g=>S(g,f),onDragEnd:H,className:`flex items-center gap-3 p-3 rounded-lg bg-muted/50 group transition-all ${D===f?"opacity-50 scale-95":""} ${M===f?"ring-2 ring-primary ring-offset-2":""}`,children:[e.jsx(jt,{className:"h-5 w-5 text-muted-foreground cursor-grab active:cursor-grabbing flex-shrink-0"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(z,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>J(f,f-1),disabled:f===0,children:e.jsx(bt,{className:"h-3 w-3"})}),e.jsx(z,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>J(f,f+1),disabled:f===s.length-1,children:e.jsx(wt,{className:"h-3 w-3"})})]}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground w-6",children:f+1}),e.jsx("div",{className:"w-12 h-12 rounded overflow-hidden bg-muted flex-shrink-0 flex items-center justify-center",children:kr(a)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:Tr(a)}),Pe(a)&&e.jsx("p",{className:"text-xs text-muted-foreground",children:Pe(a)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"text-xs text-muted-foreground",children:"Duração (s):"}),e.jsx(Y,{type:"number",min:0,value:a.duration,onChange:g=>Cr(a.id,parseInt(g.target.value)||0),className:"w-20 h-8"})]}),e.jsxs(nt,{children:[e.jsx(it,{asChild:!0,children:e.jsx(z,{variant:"ghost",size:"icon",className:a.start_time||a.days&&a.days.length>0?"text-primary hover:text-primary":"text-muted-foreground hover:text-foreground",children:e.jsx(Lr,{className:"h-4 w-4"})})}),e.jsx(ct,{className:"w-80",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium leading-none",children:"Agendamento"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Defina quando este item deve aparecer."}),e.jsx("div",{className:"grid gap-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:`start-${a.id}`,children:"Início"}),e.jsx(Y,{id:`start-${a.id}`,type:"time",value:a.start_time||"",onChange:g=>ue(a.id,{start_time:g.target.value||null})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(F,{htmlFor:`end-${a.id}`,children:"Fim"}),e.jsx(Y,{id:`end-${a.id}`,type:"time",value:a.end_time||"",onChange:g=>ue(a.id,{end_time:g.target.value||null})})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Dias da Semana"}),e.jsx(br,{type:"multiple",variant:"outline",value:((j=a.days)==null?void 0:j.map(String))||[],onValueChange:g=>{const E=g.map(Number).sort((W,q)=>W-q);ue(a.id,{days:E.length>0?E:null})},className:"flex justify-between",children:["D","S","T","Q","Q","S","S"].map((g,E)=>e.jsx(jr,{value:String(E),className:"h-8 w-8 p-0",title:["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"][E],children:g},E))}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:a.days&&a.days.length>0?a.days.length===7?"Todos os dias":"Apenas dias selecionados":"Todos os dias (Padrão)"})]})]})})]}),e.jsx(z,{variant:"ghost",size:"icon",onClick:()=>Sr(a.id),className:"opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(He,{className:"h-4 w-4 text-destructive"})})]},a.id)})]})}),e.jsx("div",{className:"p-4 border-t bg-background mt-auto shrink-0",children:y?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(F,{children:"Selecione um item:"}),e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>_(!1),children:"Cancelar"})]}),e.jsxs(ot,{value:I,onValueChange:a=>k(a),children:[e.jsxs(lt,{className:"grid w-full grid-cols-3",children:[e.jsxs(he,{value:"media",className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),"Mídias"]}),e.jsxs(he,{value:"widgets",className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Widgets"]}),e.jsxs(he,{value:"links",className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-4 w-4"}),"Links"]})]}),e.jsx(pe,{value:"media",className:"mt-3",children:e.jsx(te,{className:"h-[200px]",children:_e.length===0?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Todas as mídias já foram adicionadas"}):e.jsx("div",{className:"grid grid-cols-2 gap-2",children:_e.map(a=>e.jsxs("div",{onClick:()=>de(a),className:"flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded overflow-hidden bg-muted flex-shrink-0 flex items-center justify-center",children:a.file_type==="image"?e.jsx("img",{src:a.file_url,alt:"",className:"w-full h-full object-cover"}):De(a.file_type)}),e.jsx("span",{className:"text-sm truncate",children:a.name})]},a.id))})})}),e.jsx(pe,{value:"widgets",className:"mt-3",children:e.jsx(te,{className:"h-[200px]",children:u.length===0?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Nenhum widget disponível. Crie widgets na seção Widgets."}):e.jsx("div",{className:"grid grid-cols-2 gap-2",children:u.map(a=>{const f=()=>{switch(a.widget_type){case"clock":return e.jsx(Re,{});case"weather":return e.jsx(Ie,{});case"rss":return e.jsx(Le,{});default:return e.jsx(re,{className:"h-5 w-5 text-muted-foreground"})}};return e.jsxs("div",{onClick:()=>yr(a),className:"flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded overflow-hidden bg-muted flex-shrink-0 flex items-center justify-center",children:e.jsx(f,{})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm truncate block",children:a.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Ae(a.widget_type)})]})]},a.id)})})})}),e.jsx(pe,{value:"links",className:"mt-3",children:e.jsx(te,{className:"h-[200px]",children:m.length===0?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Nenhum link externo disponível. Crie links na seção Links Externos."}):e.jsx("div",{className:"grid grid-cols-2 gap-2",children:m.map(a=>e.jsxs("div",{onClick:()=>Nr(a),className:"flex items-center gap-2 p-2 rounded-lg border cursor-pointer hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded overflow-hidden bg-muted flex-shrink-0 flex items-center justify-center",children:e.jsx(Me,{link:a})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm truncate block",children:a.title}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a.platform})]})]},a.id))})})})]})]}):e.jsxs(z,{onClick:()=>_(!0),className:"w-full",variant:"outline",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Adicionar Item"]})})]})]})}):null}function Ht(r){const o=Mr(),t=async()=>{const{data:c,error:u}=await T.from("playlists").select("*").eq("user_id",r).order("created_at",{ascending:!1});if(u)throw u;return await Promise.all((c||[]).map(async m=>{const{data:h}=await T.from("playlist_items").select("duration, media:media_id(file_url, thumbnail_url, file_type)").eq("playlist_id",m.id).order("position",{ascending:!0});let p=m.cover_url;if(!p&&h&&h.length>0){const w=h.find(y=>y.media);if(w!=null&&w.media){const y=w.media;y.file_type==="video"&&y.thumbnail_url?p=y.thumbnail_url:y.file_type==="image"&&(p=y.file_url)}}return{...m,item_count:(h==null?void 0:h.length)||0,total_duration:(h==null?void 0:h.reduce((w,y)=>w+y.duration,0))||0,cover_url:p}}))},{data:n=[],isLoading:s,refetch:l}=ft({queryKey:["playlists",r],queryFn:t,enabled:!!r||void 0}),d=at({mutationFn:async c=>{const{error:u}=await T.from("playlists").delete().eq("id",c);if(u)throw u;return c},onSuccess:()=>{o.invalidateQueries({queryKey:["playlists"]}),C.success("Playlist excluída!")},onError:c=>{console.error("Error deleting playlist:",c),C.error("Erro ao excluir playlist")}});return{playlists:n,loading:s,fetchPlaylists:l,deletePlaylist:d.mutateAsync}}function xs(){const{user:r}=ve(),{playlists:o,loading:t,fetchPlaylists:n,deletePlaylist:s}=Ht(r==null?void 0:r.id),[l,d]=i.useState(""),[c,u]=i.useState(!1),[x,m]=i.useState(!1),[h,p]=i.useState(null),[w,y]=i.useState(null),[_,I]=i.useState(!1),k=async()=>{w&&(I(!0),await s(w),I(!1),y(null))},D=v=>{p(v),u(!0)},A=v=>{p(v),m(!0)},M=v=>{const R=Math.floor(v/60),O=v%60;return`${R}:${O.toString().padStart(2,"0")}`},P=o.filter(v=>v.name.toLowerCase().includes(l.toLowerCase()));return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold",children:"Playlists"}),e.jsx("p",{className:"text-muted-foreground",children:"Organize suas mídias em sequências"})]}),e.jsxs(z,{className:"gradient-primary",onClick:()=>{p(null),u(!0)},children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Nova Playlist"]})]}),e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(ht,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Y,{placeholder:"Buscar playlists...",value:l,onChange:v=>d(v.target.value),className:"pl-10"})]}),t?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((v,R)=>e.jsxs("div",{className:"flex flex-col space-y-3",children:[e.jsx(fe,{className:"h-[180px] w-full rounded-xl"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{className:"h-4 w-full"}),e.jsx(fe,{className:"h-4 w-2/3"})]})]},R))}):P.length===0?e.jsx(Kr,{icon:xe,title:l?"Nenhuma playlist encontrada":"Nenhuma playlist ainda",description:l?"Tente ajustar sua busca com outros termos.":"Crie playlists para organizar suas mídias e exibí-las nas telas.",action:l?void 0:{label:"Criar Playlist",onClick:()=>{p(null),u(!0)},icon:ge}}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:P.map(v=>e.jsxs(zr,{className:"glass group hover:shadow-lg transition-shadow overflow-hidden",children:[e.jsx("div",{className:"h-32 bg-muted/50 flex items-center justify-center cursor-pointer",onClick:()=>A(v),children:v.cover_url?e.jsx("img",{src:v.cover_url,alt:v.name,className:"w-full h-full object-cover"}):e.jsx(xe,{className:"h-12 w-12 text-muted-foreground"})}),e.jsxs(Gr,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold truncate",children:v.name}),e.jsx(Or,{variant:v.is_active?"default":"secondary",children:v.is_active?"Ativa":"Inativa"})]}),v.description&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 mt-1",children:v.description})]}),e.jsxs(Wr,{children:[e.jsx(Vr,{asChild:!0,children:e.jsx(z,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(pt,{className:"h-4 w-4"})})}),e.jsxs(Fr,{align:"end",children:[e.jsxs(me,{onClick:()=>A(v),children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Gerenciar Mídias"]}),e.jsxs(me,{onClick:()=>D(v),children:[e.jsx(xt,{className:"h-4 w-4 mr-2"}),"Editar"]}),e.jsxs(me,{onClick:()=>y(v.id),className:"text-destructive",children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),"Excluir"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground cursor-pointer hover:text-foreground transition-colors",onClick:()=>A(v),children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsxs("span",{children:[v.item_count," mídias"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsx("span",{children:M(v.total_duration||0)})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-3",children:["Criada em ",gt(new Date(v.created_at),"dd 'de' MMM, yyyy",{locale:vt})]})]})]},v.id))}),e.jsx(yt,{open:c,onOpenChange:u,playlist:h,onSaved:n}),e.jsx(Ft,{open:x,onOpenChange:m,playlist:h}),e.jsx(Hr,{open:!!w,onOpenChange:v=>!v&&y(null),children:e.jsxs(Ur,{children:[e.jsxs($r,{children:[e.jsx(Br,{children:"Excluir playlist?"}),e.jsx(qr,{children:"Esta ação não pode ser desfeita. A playlist e todos os itens serão removidos."})]}),e.jsxs(Xr,{children:[e.jsx(Yr,{disabled:_,children:"Cancelar"}),e.jsx(Qr,{onClick:k,disabled:_,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:_?"Excluindo...":"Excluir"})]})]})})]})}export{xs as default};
